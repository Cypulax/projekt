zad.1
1.1
SELECT AVG(pensja) AS avg_salary FROM EMPLOYEE;

1.2
SELECT 
    JOB_POSITION_ID,
    AVG(pensja) AS avg_salary,
    COUNT(*) AS employee_count
FROM EMPLOYEE
GROUP BY JOB_POSITION_ID;

1.3
SELECT
    DEPARTMENT_ID,
    AVG(YEAR(CURDATE()) - YEAR(BIRTH_DATE)) AS avg_age
FROM EMPLOYEE
GROUP BY DEPARTMENT_ID;

zad.2
2.1
SELECT 
    DEPARTMENT_ID,
    SUM(pensja) AS total_salary
FROM EMPLOYEE
GROUP BY DEPARTMENT_ID
ORDER BY total_salary DESC;

2.2
SELECT 
    JOB_POSITION_ID,
    AVG(pensja) AS avg_salary,
    COUNT(*) AS employee_count
FROM EMPLOYEE
GROUP BY JOB_POSITION_ID
HAVING COUNT(*) >= 3 AND AVG(pensja) > 3000;

2.3
SELECT 
    DEPARTMENT_ID,
    COUNT(DISTINCT pensja) AS distinct_salary_count,
    COUNT(*) AS employee_count
FROM EMPLOYEE
GROUP BY DEPARTMENT_ID
HAVING COUNT(*) > 4
ORDER BY distinct_salary_count ASC;

zad.3
3.1
CREATE TABLE DEPARTMENT AS
SELECT * FROM company_2025.DEPARTMENT;

CREATE TABLE JOB_POSITION AS
SELECT * FROM company_2025.JOB_POSITION;

3.2
SELECT 
    DEPARTMENT.DEPARTMENT_NAME AS DEPARTMENT_NAME,
    COUNT(EMPLOYEE.EMPLOYEE_NAME) AS employee_count
FROM DEPARTMENT
LEFT JOIN EMPLOYEE ON DEPARTMENT.DEPARTMENT_ID = EMPLOYEE.DEPARTMENT_ID
GROUP BY DEPARTMENT.DEPARTMENT_ID, DEPARTMENT.DEPARTMENT_NAME;

3.3
SELECT
    DEPARTMENT.DEPARTMENT_NAME AS department_name,
    CONCAT(EMPLOYEE.FIRST_NAME, ' ', EMPLOYEE.LAST_NAME) AS name
FROM DEPARTMENT
JOIN EMPLOYEE ON DEPARTMENT.DEPARTMENT_ID = EMPLOYEE.DEPARTMENT_ID
ORDER BY DEPARTMENT.DEPARTMENT_NAME, EMPLOYEE.LAST_NAME, EMPLOYEE.FIRST_NAME;

zad.4
4.1
SELECT 
    LAST_NAME,
    POSITION_NAME
FROM EMPLOYEE
NATURAL JOIN JOB_POSITION
WHERE YEAR(BIRTH_DATE) BETWEEN 1990 AND 1999;

4.2
SELECT 
    FIRST_NAME,
    LAST_NAME,
    BIRTH_DATE
FROM EMPLOYEE
JOIN JOB_POSITION USING (JOB_POSITION_ID)
WHERE POSITION_NAME = 'Magazynier'
ORDER BY BIRTH_DATE DESC
LIMIT 5;

4.3
SELECT
    C1.SHORT_NAME AS client1,
    C2.SHORT_NAME AS client2
FROM CLIENT C1
JOIN CLIENT C2 
    ON C1.CLIENT_ID + 5 = C2.CLIENT_ID
ORDER BY C1.CLIENT_ID;

zad.5
5.1
SELECT 
    JOB_POSITION_ID,
    AVG(pensja) AS avg_salary,
    COUNT(*) AS employee_count
FROM EMPLOYEE
JOIN DEPARTMENT USING (DEPARTMENT_ID)
WHERE DEPARTMENT_NAME NOT IN ('IT', 'HR')
GROUP BY JOB_POSITION_ID
HAVING COUNT(*) > 3;

5.2
SELECT
    EMPLOYEE.FIRST_NAME,
    EMPLOYEE.LAST_NAME,
    EMPLOYEE.BIRTH_DATE,
    EMPLOYEE.DEPARTMENT_ID
FROM EMPLOYEE
JOIN (
    SELECT 
        JOB_POSITION_ID,
        MIN(BIRTH_DATE) AS min_birth,
        MAX(BIRTH_DATE) AS max_birth
    FROM EMPLOYEE
    GROUP BY JOB_POSITION_ID
) X
ON X.JOB_POSITION_ID = EMPLOYEE.JOB_POSITION_ID
AND (EMPLOYEE.BIRTH_DATE = X.min_birth
    OR EMPLOYEE.BIRTH_DATE = X.max_birth)
ORDER BY DEPARTMENT_ID ASC;

